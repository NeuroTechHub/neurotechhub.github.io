{{ define "main" }}
<section class="section" style="padding: var(--spacing-lg) 0">
  <div class="container">
    <!-- Filter Section -->
    <div style="margin-bottom: 2rem">
      <div
        style="
          display: flex;
          gap: 1rem;
          flex-wrap: wrap;
          align-items: center;
          justify-content: center;
        "
      >
        <input
          type="text"
          id="searchInput"
          placeholder="Search talks..."
          class="search-input"
        />

        <select id="tagFilter" class="filter-select">
          <option value="">All Topics</option>
          {{ $talkTags := slice }} {{ range .Pages }} {{ range .Params.tags }}
          {{ $talkTags = $talkTags | append . }} {{ end }} {{ end }} {{ range
          (($talkTags | uniq) | sort) }} {{ $tag := . }} {{ $count := 0 }} {{
          range $talkTags }} {{ if eq . $tag }} {{ $count = add $count 1 }} {{
          end }} {{ end }}
          <option value="{{ . }}">{{ . | title }} ({{ $count }})</option>
          {{ end }}
        </select>

        <button
          id="clearFilters"
          style="
            padding: 0.5rem 1rem;
            background: var(--color-accent);
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
          "
        >
          Clear Filters
        </button>
      </div>
    </div>

    <!-- Upcoming Talks Section -->
    {{ $upcomingTalks := where .Pages ".Params.event_date" "ge" (now.Format
    "2006-01-02") }} {{ if $upcomingTalks }}
    <div class="upcoming-section">
      <h2
        style="
          font-size: 2rem;
          margin-bottom: 3rem;
          color: var(--color-white);
          text-align: center;
        "
      ></h2>

      <div class="grid grid-2" id="upcomingGrid">
        {{ range first 3 ($upcomingTalks.ByParam "event_date") }} {{ partial
        "talk-card-upcoming.html" . }} {{ end }}
      </div>
    </div>
    {{ else }}
    <div class="upcoming-section">
      <h2
        style="
          font-size: 2rem;
          margin-bottom: 2rem;
          color: var(--color-white);
          text-align: center;
        "
      ></h2>
      <div
        class="theme-box"
        style="text-align: center; padding: 3rem; border-radius: 1rem"
      >
        <h3 style="color: var(--text-primary); margin-bottom: 1rem">
          No talks coming up, if you want to organise one or suggest a topic,
          please let us know!
        </h3>
        <a
          href="https://github.com/neurotechhub/website/issues/new?template=talk-proposal.md"
          target="_blank"
          rel="noopener"
          class="hero-cta"
          style="margin-top: 1rem"
        >
          Propose a Talk
        </a>
      </div>
    </div>
    {{ end }}

    <!-- Past Talks Section -->
    {{ $pastTalks := where .Pages ".Params.event_date" "lt" (now.Format
    "2006-01-02") }} {{ if $pastTalks }}
    <div class="past-section" style="margin-top: 4rem">
      <h2
        style="
          font-size: 2rem;
          margin-bottom: 2rem;
          color: var(--color-white);
          text-align: center;
        "
      ></h2>

      <div class="grid-past-talks" id="pastGrid">
        {{ range first 6 ($pastTalks.ByParam "event_date") }} {{ partial
        "talk-card-past.html" . }} {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- No results message -->
    <div
      id="noResults"
      style="
        display: none;
        text-align: center;
        padding: 2rem;
        color: var(--color-gray);
      "
    >
      <h3>No talks found</h3>
      <p>Try adjusting your search or filter criteria.</p>
    </div>

    <!-- Call to action -->
    <div
      class="theme-box"
      style="
        margin-top: 4rem;
        text-align: center;
        padding: 3rem;
        border-radius: 1rem;
      "
    >
      <h3 style="color: var(--text-primary); margin-bottom: 1rem">
        Want to Give a Talk?
      </h3>
      <p
        style="
          color: var(--text-secondary);
          margin-bottom: 2rem;
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
        "
      >
        We're always looking for speakers to share their knowledge and insights
        with our community. Whether you're a researcher, engineer, or industry
        professional, we'd love to hear from you.
      </p>
      <div
        style="
          display: flex;
          gap: 1rem;
          justify-content: center;
          flex-wrap: wrap;
        "
      >
        <a
          href="https://github.com/neurotechhub/website/issues/new?template=talk-proposal.md"
          target="_blank"
          rel="noopener"
          class="hero-cta"
        >
          Propose a Talk
        </a>
        <a
          href="https://discord.gg/FhZA5rB7Tq"
          target="_blank"
          rel="noopener"
          class="hero-cta"
        >
          Discuss on Discord
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const tagFilter = document.getElementById("tagFilter");
    const clearFiltersBtn = document.getElementById("clearFilters");
    const noResults = document.getElementById("noResults");
    const talkCards = document.querySelectorAll(".talk-card");

    function filterTalks() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedTag = tagFilter.value.toLowerCase();

      let visibleCount = 0;

      talkCards.forEach((card) => {
        const title = card.dataset.title;
        const summary = card.dataset.summary;
        const speaker = card.dataset.speaker;
        const tags = card.dataset.tags;

        // Search filter
        const matchesSearch =
          !searchTerm ||
          title.includes(searchTerm) ||
          summary.includes(searchTerm) ||
          speaker.includes(searchTerm);

        // Tag filter
        const matchesTag = !selectedTag || tags.includes(selectedTag);

        if (matchesSearch && matchesTag) {
          card.style.display = "block";
          visibleCount++;
        } else {
          card.style.display = "none";
        }
      });

      // Show/hide no results message
      if (visibleCount === 0 && (searchTerm || selectedTag)) {
        noResults.style.display = "block";
      } else {
        noResults.style.display = "none";
      }
    }

    function clearAllFilters() {
      searchInput.value = "";
      tagFilter.value = "";
      filterTalks();
    }

    // Add event listeners
    searchInput.addEventListener("input", filterTalks);
    tagFilter.addEventListener("change", filterTalks);
    clearFiltersBtn.addEventListener("click", clearAllFilters);
  });
</script>
{{ end }}
