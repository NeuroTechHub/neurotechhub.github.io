{{ define "main" }}
<section class="section" style="padding: var(--spacing-lg) 0">
  <div class="container">
    <!-- Filter Section -->
    <div style="margin-bottom: 2rem">
      <div
        style="
          display: flex;
          gap: 1rem;
          flex-wrap: wrap;
          align-items: center;
          justify-content: center;
        "
      >
        <input
          type="text"
          id="searchInput"
          placeholder="Search talks..."
          class="search-input"
        />

        <select id="typeFilter" class="filter-select">
          <option value="">All Talks</option>
          <option value="upcoming">Upcoming Only</option>
          <option value="past">Past Only</option>
        </select>

        <select id="tagFilter" class="filter-select">
          <option value="">All Topics</option>
          {{ range .Site.Taxonomies.tags }}
          <option value="{{ .Page.Title }}">
            {{ .Page.Title | title }} ({{ .Count }})
          </option>
          {{ end }}
        </select>

        <button
          id="clearFilters"
          style="
            padding: 0.5rem 1rem;
            background: var(--color-accent);
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
          "
        >
          Clear Filters
        </button>
      </div>
    </div>

    <!-- Upcoming Talks Section -->
    {{ $upcomingTalks := where .Pages ".Params.event_date" "ge" (now.Format
    "2006-01-02") }} {{ if $upcomingTalks }}
    <div class="upcoming-section">
      <h2
        style="
          font-size: 2rem;
          margin-bottom: 3rem;
          color: var(--color-white);
          text-align: center;
        "
      ></h2>

      <div class="grid grid-2" id="upcomingGrid">
        {{ range first 3 ($upcomingTalks.ByParam "event_date") }}
        {{ partial "talk-card-upcoming.html" . }}
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Past Talks Section -->
    {{ $pastTalks := where .Pages ".Params.event_date" "lt" (now.Format
    "2006-01-02") }} {{ if $pastTalks }}
    <div class="past-section" style="margin-top: 4rem">
      <h2
        style="
          font-size: 2rem;
          margin-bottom: 2rem;
          color: var(--color-white);
          text-align: center;
        "
      ></h2>

      <div class="grid grid-3" id="pastGrid">
        {{ range first 6 ($pastTalks.ByParam "event_date") }}
        {{ partial "talk-card-past.html" . }}
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- No results message -->
    <div
      id="noResults"
      style="
        display: none;
        text-align: center;
        padding: 2rem;
        color: var(--color-gray);
      "
    >
      <h3>No talks found</h3>
      <p>Try adjusting your search or filter criteria.</p>
    </div>

    <!-- Call to action -->
    <div
      class="theme-box"
      style="
        margin-top: 5rem;
        text-align: center;
        padding: 3rem;
        border-radius: 1rem;
      "
    >
      <h3 style="color: var(--text-primary); margin-bottom: 1rem">
        Want to Give a Talk?
      </h3>
      <p
        style="
          color: var(--text-secondary);
          margin-bottom: 2rem;
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
        "
      >
        We're always looking for speakers to share their knowledge and insights
        with our community. Whether you're a researcher, engineer, or industry
        professional, we'd love to hear from you.
      </p>
      <div
        style="
          display: flex;
          gap: 1rem;
          justify-content: center;
          flex-wrap: wrap;
        "
      >
        <a
          href="https://github.com/neurotechhub/website/issues/new?template=talk-proposal.md"
          target="_blank"
          rel="noopener"
          class="hero-cta"
        >
          Propose a Talk
        </a>
        <a
          href="https://discord.gg/neurotech"
          target="_blank"
          rel="noopener"
          class="hero-cta"
        >
          Discuss on Discord
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");
    const typeFilter = document.getElementById("typeFilter");
    const tagFilter = document.getElementById("tagFilter");
    const clearFilters = document.getElementById("clearFilters");
    const upcomingGrid = document.getElementById("upcomingGrid");
    const pastGrid = document.getElementById("pastGrid");
    const upcomingSection = document.querySelector(".upcoming-section");
    const pastSection = document.querySelector(".past-section");
    const noResults = document.getElementById("noResults");
    const talkCards = document.querySelectorAll(".talk-card");

    function filterTalks() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedType = typeFilter.value;
      const selectedTag = tagFilter.value.toLowerCase();

      let upcomingVisible = 0;
      let pastVisible = 0;

      talkCards.forEach((card) => {
        const title = card.dataset.title;
        const summary = card.dataset.summary;
        const speaker = card.dataset.speaker;
        const tags = card.dataset.tags;
        const type = card.dataset.type;

        // Search filter
        const matchesSearch =
          !searchTerm ||
          title.includes(searchTerm) ||
          summary.includes(searchTerm) ||
          speaker.includes(searchTerm);

        // Type filter
        const matchesType = !selectedType || type === selectedType;

        // Tag filter
        const matchesTag = !selectedTag || tags.includes(selectedTag);

        if (matchesSearch && matchesType && matchesTag) {
          card.style.display = "block";
          if (type === "upcoming") upcomingVisible++;
          else if (type === "past") pastVisible++;
        } else {
          card.style.display = "none";
        }
      });

      // Show/hide sections based on filter results
      if (upcomingSection) {
        upcomingSection.style.display =
          selectedType === "past" || upcomingVisible === 0 ? "none" : "block";
      }

      if (pastSection) {
        pastSection.style.display =
          selectedType === "upcoming" || pastVisible === 0 ? "none" : "block";
      }

      // Show/hide no results message
      const totalVisible = upcomingVisible + pastVisible;
      if (totalVisible === 0 && (searchTerm || selectedType || selectedTag)) {
        noResults.style.display = "block";
      } else {
        noResults.style.display = "none";
      }
    }

    function clearAllFilters() {
      searchInput.value = "";
      typeFilter.value = "";
      tagFilter.value = "";
      filterTalks();
    }

    // Add event listeners
    searchInput.addEventListener("input", filterTalks);
    typeFilter.addEventListener("change", filterTalks);
    tagFilter.addEventListener("change", filterTalks);
    clearFilters.addEventListener("click", clearAllFilters);
  });
</script>
{{ end }}
