{{ define "main" }}
<section class="section" style="padding: var(--spacing-lg) 0;">
    <div class="container">
        <!-- Filter/Search Section -->
        <div style="margin-bottom: 2rem;">
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: center;">
                <input type="text" id="searchInput" placeholder="Search posts..." class="search-input">

                <select id="tagFilter" class="filter-select">
                    <option value="">All Tags</option>
                    {{ $blogTags := slice }}
                    {{ range where .Site.RegularPages "Type" "eq" "blog" }}
                        {{ range .Params.tags }}
                            {{ $blogTags = $blogTags | append . }}
                        {{ end }}
                    {{ end }}
                    {{ range (($blogTags | uniq) | sort) }}
                        {{ $tag := . }}
                        {{ $count := 0 }}
                        {{ range $blogTags }}
                            {{ if eq . $tag }}
                                {{ $count = add $count 1 }}
                            {{ end }}
                        {{ end }}
                        <option value="{{ . }}">{{ . | title }} ({{ $count }})</option>
                    {{ end }}
                </select>

                <button id="clearFilters" style="padding: 0.5rem 1rem; background: var(--color-accent); color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                    Clear Filters
                </button>
            </div>
        </div>
        
        <!-- Posts Grid -->
        <div class="grid grid-2" id="postsGrid">
            {{ range .Paginator.Pages }}
            <article class="card post-card"
                     data-title="{{ .Title | lower }}"
                     data-summary="{{ .Params.summary | default .Summary | lower }}"
                     data-tags="{{ range .Params.tags }}{{ . | lower }} {{ end }}"
                     data-author="{{ .Params.author | lower }}"
                     data-date="{{ .Date.Format "2006-01-02" }}"
                     data-url="{{ .RelPermalink }}"
                     onclick="window.location.href='{{ .RelPermalink }}'">
                
                {{ if .Params.featured_image }}
                {{ with .Resources.GetMatch .Params.featured_image }}
                <img src="{{ .RelPermalink }}" alt="{{ $.Title }}" class="card-image">
                {{ end }}
                {{ end }}
                
                <h2 class="card-title">{{ .Title }}</h2>
                
                <div class="card-meta">
                    {{ .Date.Format "January 2, 2006" }}
                    {{ if .Params.author }} • {{ .Params.author }}{{ end }}
                    {{ if .ReadingTime }} • {{ .ReadingTime }} min read{{ end }}
                </div>
                
                <p class="card-summary">{{ .Params.summary | default .Summary }}</p>
                
                {{ if .Params.tags }}
                <div class="card-tags">
                    {{ range .Params.tags }}
                    <span class="tag">{{ . }}</span>
                    {{ end }}
                </div>
                {{ end }}
            </article>
            {{ end }}
        </div>
        
        <!-- No results message -->
        <div id="noResults" style="display: none; text-align: center; padding: 2rem; color: var(--color-gray);">
            <h3>No posts found</h3>
            <p>Try adjusting your search or filter criteria.</p>
        </div>
        
        <!-- Pagination -->
        {{ if .Paginator.HasPrev }}
        <div style="text-align: center; margin: 3rem 0;">
            <div style="display: inline-flex; gap: 1rem; align-items: center;">
                {{ if .Paginator.HasPrev }}
                <a href="{{ .Paginator.Prev.URL }}" class="hero-cta">← Previous</a>
                {{ end }}
                
                <span style="color: var(--color-light);">
                    Page {{ .Paginator.PageNumber }} of {{ .Paginator.TotalPages }}
                </span>
                
                {{ if .Paginator.HasNext }}
                <a href="{{ .Paginator.Next.URL }}" class="hero-cta">Next →</a>
                {{ end }}
            </div>
        </div>
        {{ end }}
        
        <!-- Call to action -->
        <div class="theme-box" style="margin-top: 4rem; text-align: center; padding: 3rem; border-radius: 1rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Want to Write a Post?</h3>
            <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
                We welcome contributions from the community. Share your insights, research findings, or project updates 
                with fellow neurotechnology enthusiasts. Check out our contribution guidelines to get started.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="https://github.com/neurotechhub/website/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener" class="hero-cta">
                   Contribution Guidelines
                </a>
                <a href="https://github.com/neurotechhub/website/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener" class="hero-cta">Write post</a>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const tagFilter = document.getElementById('tagFilter');
    const clearFiltersBtn = document.getElementById('clearFilters');
    const postsGrid = document.getElementById('postsGrid');
    const noResults = document.getElementById('noResults');
    const postCards = document.querySelectorAll('.post-card');

    function filterPosts() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedTag = tagFilter.value.toLowerCase();

        let visibleCount = 0;

        postCards.forEach(card => {
            const title = card.dataset.title;
            const summary = card.dataset.summary;
            const tags = card.dataset.tags;
            const author = card.dataset.author;

            // Search filter
            const matchesSearch = !searchTerm ||
                title.includes(searchTerm) ||
                summary.includes(searchTerm) ||
                author.includes(searchTerm);

            // Tag filter
            const matchesTag = !selectedTag ||
                tags.includes(selectedTag);

            if (matchesSearch && matchesTag) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // Show/hide no results message
        if (visibleCount === 0) {
            noResults.style.display = 'block';
            postsGrid.style.display = 'none';
        } else {
            noResults.style.display = 'none';
            postsGrid.style.display = 'grid';
        }
    }

    // Clear filters function
    function clearFilters() {
        searchInput.value = '';
        tagFilter.value = '';
        filterPosts();
    }

    // Add event listeners
    searchInput.addEventListener('input', filterPosts);
    tagFilter.addEventListener('change', filterPosts);
    clearFiltersBtn.addEventListener('click', clearFilters);
});
</script>
{{ end }}